// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace PrOnWeb.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\_Imports.razor"
using PrOnWeb;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\_Imports.razor"
using PrOnWeb.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\_Imports.razor"
using PrOnWeb.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\_Imports.razor"
using Syncfusion.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\_Imports.razor"
using Syncfusion.Blazor.Calendars;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\_Imports.razor"
using Syncfusion.Blazor.Grids;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\Pages\UserProfile.razor"
using Syncfusion.Blazor.Inputs;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\Pages\UserProfile.razor"
using Syncfusion.Blazor.Buttons;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\Pages\UserProfile.razor"
using Syncfusion.Blazor.Popups;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\Pages\UserProfile.razor"
using Syncfusion.Blazor.DropDowns;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\Pages\UserProfile.razor"
using Syncfusion.Blazor.Notifications;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\Pages\UserProfile.razor"
using Microsoft.AspNetCore.Identity;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\Pages\UserProfile.razor"
           [Authorize(Roles = "Administrators")]

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\Pages\UserProfile.razor"
           [Authorize]

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Components.RouteAttribute("/UserProfile/{userName}")]
    public partial class UserProfile : global::Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 267 "D:\KHOTDEE_WORK\TPAC_TPCC\PR Online\PrOnWeb\PrOnWeb_No_Git\PrOnWeb\Pages\UserProfile.razor"
       
    [Parameter] public string userName { get; set; }
    int PrUserId;

    List<WorkflowAutho> workFlowAuthos;
    ApplicationUser thisUser;

    bool isAddWorkflowVisible = false;

    //private List<MultipleSelectorModel> AllRoles = new List<MultipleSelectorModel>();
    //private List<MultipleSelectorModel> Selected = new List<MultipleSelectorModel>();
    //private List<MultipleSelectorModel> NotSelected = new List<MultipleSelectorModel>();
    private List<Master_Role> AllRoles = new List<Master_Role>();
    private List<Master_Role> Selected = new List<Master_Role>();
    private List<Master_Role> NotSelected = new List<Master_Role>();


    //List<MasterDimension> allMasterDimension;
    bool isActiveUser;
    List<Master_Org> allMasterOrgs;
    List<Master_Dep> allMasterDeps;
    List<Master_Sec> allMasterSecs;
    string SelOrg = "";
    string SelDep = "";
    string SelSec = "";
    int SelWFOrder = 0;
    int SelWFPos = 0;
    bool setRange1 = false;
    bool setRange2 = false;
    bool setRange3 = false;
    bool setRange4 = false;
    bool setRange5 = false;

    public class masOrgs
    {
        public string OrgId { get; set; }
        public string OrgText { get; set; }
    }
    public class masDeps
    {
        public string DepId { get; set; }
        public string DepText { get; set; }
    }
    public class masSecs
    {
        public string SecId { get; set; }
        public string SecText { get; set; }
    }

    IList<string> thisUserRoles;

    //=========================================================
    protected override async Task OnInitializedAsync()
    {
        thisUser = _UserManager.Users.FirstOrDefault(x => x.UserName == userName);
        isActiveUser = thisUser.EmailConfirmed;
        PrUserId = Int32.Parse(thisUser.PrUserId);

        thisUserRoles = await _UserManager.GetRolesAsync(thisUser);

        var allRole = _RoleManager.Roles.OrderBy(x => x.Name).ToList();
        List<Master_Role> MasterRoles = new List<Master_Role>();
        foreach (var item in allRole)
        {
            MasterRoles.Add(new Master_Role { Id = item.Id, Role = item.Name });
        };

        foreach (Master_Role item in MasterRoles)
        {
            if (thisUserRoles.Contains(item.Role))
            {
                Selected.Add(item);
            }
            else
                NotSelected.Add(item);
        }

        //var AllRoles = _RoleManager.Roles.Select(x => new MultipleSelectorModel(x.Id.ToString(), x.Name)).ToList();
        //foreach (MultipleSelectorModel item in AllRoles)
        //{
        //    if (roles.Contains(item.Value))
        //    {
        //        Selected.Add(item);
        //    }
        //    else
        //        NotSelected.Add(item);
        //}

        //Selected = SelectedGenres.Select(x => new MultipleSelectorModel(x.Id.ToString(), x.Name)).ToList();
        //NotSelected = NotSelectedGenres.Select(x => new MultipleSelectorModel(x.Id.ToString(), x.Name)).ToList();

        workFlowAuthos = await prDataService.GetWorkflowAuthosAsync(PrUserId);

        //allMasterDimension = await prDataService.GetMasterDimensionsAsync();
        allMasterOrgs = await prDataService.GetMasterOrgsAsync();
        allMasterDeps = await prDataService.GetMasterDepsAsync();
        allMasterSecs = await prDataService.GetMasterSecsAsync();
    }

    public async Task SaveChange()
    {
        // remove existing Role
        foreach (var role in thisUserRoles)
        {
            var result = await _UserManager.RemoveFromRoleAsync(thisUser, role);
        }
        // add Selected Role
        foreach (Master_Role item in Selected)
        {
            var result = await _UserManager.AddToRoleAsync(thisUser, item.Role);
        }

        thisUser.EmailConfirmed = isActiveUser;
        var result1 = await _UserManager.UpdateAsync(thisUser);
        await this.ToastObj.Show(Toast[0]);
    }

    private async Task OnCloseWorkflowClick(Object args)
    {
        isAddWorkflowVisible = false;
        WFgrid.Refresh();
    }

    private async Task OnSaveWorkflowClick(Object args)
    {
        if (isEditMode) // update
        {
            thisWFAutho.User_Id = PrUserId;
            thisWFAutho.Org = SelOrg;
            thisWFAutho.Dep = SelDep;
            thisWFAutho.Sec = SelSec;
            thisWFAutho.Wf_Order = SelWFOrder;
            thisWFAutho.Wf_Position = SelWFPos;
            thisWFAutho.BudgetRange1 = setRange1;
            thisWFAutho.BudgetRange2 = setRange2;
            thisWFAutho.BudgetRange3 = setRange3;
            thisWFAutho.BudgetRange4 = setRange4;
            thisWFAutho.BudgetRange5 = setRange5;
            await prDataService.UpdateWorkflowAsync(thisWFAutho);

        }
        else // add mode
        {
            thisWFAutho = new WorkflowAutho()
            {
                User_Id = PrUserId,
                Org = SelOrg,
                Dep = SelDep,
                Sec = SelSec,
                Wf_Order = SelWFOrder,
                Wf_Position = SelWFPos,
                BudgetRange1 = setRange1,
                BudgetRange2 = setRange2,
                BudgetRange3 = setRange3,
                BudgetRange4 = setRange4,
                BudgetRange5 = setRange5
            };
            await prDataService.CreateWorkflowAuthoAsync(thisWFAutho);
        }
        isAddWorkflowVisible = false;
        workFlowAuthos = await prDataService.GetWorkflowAuthosAsync(PrUserId);
        WFgrid.Refresh();
    }

    public bool isEditMode = true;
    private void OnAddWorkflowClick(Object args)
    {
        isEditMode = false;
        SelOrg = "";
        SelDep = "";
        SelSec = "";
        SelWFOrder = 0;
        SelWFPos = 0;
        setRange1 = false;
        setRange2 = false;
        setRange3 = false;
        setRange4 = false;
        setRange5 = false;
        isAddWorkflowVisible = true;
    }

    private async Task OnSetWorkflowOrder(Object args)
    {
        if (await JsRuntime.InvokeAsync<bool>("confirm", "This will override all workflow order of this user ? "))
        {
            foreach (var item in workFlowAuthos)
            {
                item.Wf_Order = SelWFOrder;
                item.Wf_Position = SelWFPos;
                await prDataService.UpdateWorkflowAsync(item);
            }
        }
    }

    SfGrid<WorkflowAutho> WFgrid;
    WorkflowAutho thisWFAutho;

    private async Task OnEditWorkflowClick(Object args)
    {
        List<WorkflowAutho> values = await WFgrid.GetSelectedRecords();
        if (values.Count > 0)
        {
            isEditMode = true;
            thisWFAutho = values.First();
            SelOrg = thisWFAutho.Org;
            SelDep = thisWFAutho.Dep;
            SelSec = thisWFAutho.Sec;
            SelWFOrder = thisWFAutho.Wf_Order;
            SelWFPos = thisWFAutho.Wf_Position;
            setRange1 = thisWFAutho.BudgetRange1;
            setRange2 = thisWFAutho.BudgetRange2;
            setRange3 = thisWFAutho.BudgetRange3;
            setRange4 = thisWFAutho.BudgetRange4;
            setRange5 = thisWFAutho.BudgetRange5;
            isAddWorkflowVisible = true;
        }
        WFgrid.Refresh();
    }

    private List<ToastModel> Toast = new List<ToastModel>
{
        new ToastModel{ Title = "Success!", Content="Profile Saved." },
        new ToastModel{ Title = "Success!", Content="Role Updated." },
        new ToastModel{ Title = "Success!", Content="Role Deleted." },
    };
    public string ToastContent = "Content of Toast";
    SfToast ToastObj;

    private async Task DeleteWorkFlowAutho(WorkflowAutho wfa)
    {
        if (await JsRuntime.InvokeAsync<bool>("confirm", "Confirm deleting this Workflow Items ?"))
        {
            await prDataService.DeleteWorkflowAuthoAsync(wfa);
            workFlowAuthos = await prDataService.GetWorkflowAuthosAsync(PrUserId);
            WFgrid.Refresh();
        }
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JsRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private UserManager<ApplicationUser> _UserManager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private RoleManager<IdentityRole> _RoleManager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private PrOnWeb.Services.PrDataService prDataService { get; set; }
    }
}
#pragma warning restore 1591
